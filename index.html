<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flux On Customer Manager</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/components.css">
</head>
<body>

<div class="loader-overlay" id="globalLoader">
    <div class="loader-spinner"></div>
    <div class="loader-text" id="loaderText">Processing...</div>
</div>

<div class="app-container">
  <aside class="sidebar" aria-label="Main navigation">
    <div class="logo-area">
      <div class="logo">
        <div class="logo-icon" aria-hidden="true">F</div>
        <span>Flux On</span>
      </div>
    </div>
    
    <nav class="nav-menu" aria-label="Primary navigation">
      <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')" aria-current="page">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </a>
      <a href="#customers" class="nav-item" onclick="showSection('customers')">
        <span class="nav-icon">üë•</span>
        <span>Customers</span>
      </a>
      <a href="#inbox" class="nav-item" onclick="showSection('inbox')">
        <span class="nav-icon">üì•</span>
        <span>Inbox</span>
      </a>
      <a href="#automation" class="nav-item" onclick="showSection('automation')">
        <span class="nav-icon">‚ö°</span>
        <span>Automation</span>
      </a>
      <a href="#analytics" class="nav-item" onclick="showSection('analytics')">
        <span class="nav-icon">üìà</span>
        <span>Analytics</span>
      </a>
      <a href="#templates" class="nav-item" onclick="showSection('templates')">
        <span class="nav-icon">üìù</span>
        <span>Templates</span>
      </a>
      <a href="#settings" class="nav-item" onclick="showSection('settings')">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span>Settings</span>
      </a>
    </nav>
    
    <div class="nav-menu" style="flex: 0;">
      <a href="#" class="nav-item" onclick="confirmLogout()">
        <span class="nav-icon">‚Ü™</span>
        <span>Log Out</span>
      </a>
    </div>
  </aside>

  <main class="main-content">
    
    <header class="top-header" role="banner">
      <div class="header-title" id="pageTitle">
        <span>Dashboard</span>
      </div>
      
      <div class="header-actions">
        <div class="notification-btn" onclick="showSection('inbox')" title="Notifications">
            <svg class="notification-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <div class="notification-badge" id="notificationBadge">0</div>
        </div>

        <button class="btn btn-secondary" id="btnRefresh" style="height: 36px; padding: 0 12px; font-size: 13px;" onclick="refreshData()" aria-label="Refresh data">
            Refresh
        </button>
        <div class="profile-area" onclick="showSection('settings')" role="button" tabindex="0" aria-label="User profile">
          <div class="profile-avatar" id="userInitials" aria-hidden="true">U</div>
          <div class="profile-info">
            <div class="profile-name" id="profileName">User</div>
          </div>
        </div>
      </div>
    </header>
    
    <div class="page-content">
      
      <section id="dashboardSection" class="section-content" aria-labelledby="dashboardTitle">
        <div class="welcome-card">
          <h1 id="dashboardTitle">Hello, <span id="userGreeting">User</span>.</h1>
          <p>Here is your overview. Manage customers and automate flows.</p>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showSection('automation')">
              Start Automation
            </button>
            <button class="btn btn-secondary" onclick="showSection('customers')">
              Manage Customers
            </button>
          </div>
        </div>
        
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-title">Total Customers</div>
              <div class="card-icon">üë•</div>
            </div>
            <div class="card-count" id="totalCustomers" aria-live="polite">0</div>
            <div class="card-desc">Active in database</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-title">Inbox</div>
              <div class="card-icon">üì•</div>
            </div>
            <div class="card-count" id="unreadStats" aria-live="polite">0</div>
            <div class="card-desc">Unread messages</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-title">Active Campaigns</div>
              <div class="card-icon">‚ö°</div>
            </div>
            <div class="card-count" id="activeCampaigns" aria-live="polite">0</div>
            <div class="card-desc">Workflows running</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-title">Response Rate</div>
              <div class="card-icon">üìà</div>
            </div>
            <div class="card-count" id="responseRate" aria-live="polite">0%</div>
            <div class="card-desc">Average engagement</div>
          </div>
        </div>
        
        <div class="automation-card">
          <div class="automation-header">
            <h2>Quick Actions</h2>
          </div>
          <div class="automation-content">
            <div class="action-buttons">
              <button class="btn btn-secondary" onclick="showSection('automation')">
                üéâ Create Welcome Series
              </button>
              <button class="btn btn-secondary" onclick="showSection('automation')">
                üîÑ Send Follow-up
              </button>
            </div>
          </div>
        </div>
      </section>
      
      <section id="customersSection" class="section-content" aria-labelledby="customersTitle" style="display: none;">
        <div class="welcome-card">
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <div>
              <h1 id="customersTitle">Customers</h1>
              <p>View and manage your subscriber database.</p>
            </div>
            <div class="action-buttons">
               <button class="btn btn-secondary" onclick="exportCustomers()">Export CSV</button>
               <button class="btn btn-secondary" onclick="importCustomers()">Import CSV</button>
               <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleFileSelect(event)">
               <button class="btn btn-primary" onclick="addNewCustomer()">+ Add Customer</button>
            </div>
          </div>
        </div>
        
        <div class="automation-card">
          <div class="automation-header">
            <span class="card-title" style="margin: 0; font-size: 14px;">All Records <span class="data-count" id="customerCount" style="color: var(--text-tertiary); margin-left: 8px;">(0)</span></span>
            <button class="btn btn-success" id="btnSaveChanges" style="height: 36px;" onclick="saveAllChanges()">
              Save Changes
            </button>
          </div>
          
          <div id="tableContainer" style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
            <div style="padding: 40px; text-align: center; color: var(--text-tertiary);">
              Loading data...
            </div>
          </div>
        </div>
      </section>

      <section id="inboxSection" class="section-content" aria-labelledby="inboxTitle" style="display: none;">
        <div class="welcome-card" style="margin-bottom: 24px;">
           <h1 id="inboxTitle">Inbox</h1>
           <p>Messages from your audience.</p>
        </div>
        
        <div class="inbox-layout">
           <div class="inbox-list" id="inboxList">
               <div style="padding: 32px; text-align: center; color: var(--text-tertiary);">Loading...</div>
           </div>

           <div class="inbox-view" id="inboxView">
               <div class="inbox-empty-state" id="inboxEmptyState">
                   <div class="empty-icon">üì®</div>
                   <div>Select a message to read</div>
               </div>
               
               <div id="inboxContent" style="display: none; height: 100%; flex-direction: column;">
                   <div class="inbox-toolbar">
                       <div style="display: flex; align-items: center;">
                           <button class="btn btn-secondary mobile-back-btn" style="display:none; height: 32px; padding: 0 10px;" onclick="closeMobileInbox()">‚Üê</button>
                           <span style="font-size: 13px; color: var(--text-tertiary);" id="viewMetaToolbar">Reading Message</span>
                       </div>
                       <div>
                           <button class="btn btn-icon-only" onclick="deleteCurrentMessage()" title="Delete Message">
                               <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                           </button>
                       </div>
                   </div>
                   
                   <div class="inbox-view-content">
                       <div class="inbox-view-header">
                           <div class="view-subject" id="viewSubject">Subject</div>
                           <div class="view-meta">
                               <div class="view-avatar" id="viewAvatar">U</div>
                               <div class="view-info">
                                   <div class="view-sender-name" id="viewSender">Sender Name</div>
                                   <div class="view-sender-email" id="viewEmail">sender@email.com</div>
                               </div>
                               <div class="view-timestamp" id="viewDate">Today</div>
                           </div>
                       </div>
                       <div class="inbox-view-body" id="viewBody">
                           </div>
                   </div>
               </div>
           </div>
        </div>
      </section>
      
      <section id="automationSection" class="section-content" aria-labelledby="automationTitle" style="display: none;">
        <div class="welcome-card">
           <h1>Automation Center</h1>
           <p>Compose and schedule email campaigns.</p>
        </div>
        
        <div class="automation-card">
          <div class="automation-header">
            <h2>New Campaign</h2>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value" id="selectedCount" aria-live="polite">0</div>
                <div class="stat-label">Recipients</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="totalEmails" aria-live="polite">0</div>
                <div class="stat-label">Total List</div>
              </div>
            </div>
          </div>
          
          <div class="automation-content">
            <div class="email-list-section">
              <div class="select-all">
                <input type="checkbox" id="selectAllEmails" class="select-all-checkbox" onchange="toggleAllEmails()" aria-label="Select all customers">
                <label for="selectAllEmails" style="font-size: 14px; font-weight: 600;">Select All Customers</label>
              </div>
              
              <div class="email-list" id="emailList">
                <div style="padding: 24px; text-align: center;">Loading...</div>
              </div>
            </div>
            
            <div style="margin-top: 40px;">
              <h3 style="font-size: 18px; margin-bottom: 16px;">Compose Message</h3>
              
              <div class="template-selector" id="automationTemplateSelector">
                <button class="template-btn" onclick="loadTemplate('custom')">Blank</button>
              </div>
              
              <form id="messageForm" class="message-form" aria-label="Message composition form">
                <div class="form-group">
                  <label class="form-label required" for="campaignName">Campaign Name</label>
                  <input type="text" class="form-control" id="campaignName" required placeholder="e.g. Q1 Newsletter">
                </div>
                
                <div class="form-group">
                  <label class="form-label" for="scheduleType">Schedule</label>
                  <select class="form-control" id="scheduleType">
                    <option value="now">Send Immediately</option>
                    <option value="scheduled">Schedule for later</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label required" for="fromName">From Name</label>
                  <input type="text" class="form-control" id="fromName" required placeholder="Your Name">
                </div>
                
                <div class="form-group">
                  <label class="form-label required" for="fromEmail">From Email</label>
                  <input type="email" class="form-control" id="fromEmail" required placeholder="you@company.com">
                </div>

                <div class="form-group" style="display: none;">
                   <label class="form-label" for="replyToEmail">Reply To</label>
                   <input type="email" class="form-control" id="replyToEmail">
                </div>
                
                <div class="form-group full-width">
                  <label class="form-label required" for="emailSubject">Subject Line</label>
                  <input type="text" class="form-control" id="emailSubject" required placeholder="Enter a catchy subject">
                </div>
                
                <div class="form-group full-width">
                  <label class="form-label required" for="emailBody">Email Body</label>
                  <textarea class="form-control" id="emailBody" required placeholder="Write your message..." style="min-height: 200px;"></textarea>
                  <div style="margin-top: 8px; font-size: 12px; color: var(--text-tertiary); font-family: var(--font-mono);">
                    Variables: {name}, {email}, {company}
                  </div>
                </div>
                
                <div class="form-group" id="scheduleDateGroup" style="display: none;">
                  <label class="form-label" for="scheduleDateTime">Date & Time</label>
                  <input type="datetime-local" class="form-control" id="scheduleDateTime">
                </div>
                
                <div class="form-group full-width form-actions" style="display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid var(--border-light); padding-top: 24px; margin-top: 10px;">
                  <button type="button" class="btn btn-secondary" onclick="clearForm()">Reset</button>
                  <button type="submit" class="btn btn-primary">Preview & Send</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
      
      <section id="analyticsSection" class="section-content" aria-labelledby="analyticsTitle" style="display: none;">
        <div class="welcome-card">
          <h1 id="analyticsTitle">Analytics</h1>
          <p>Campaign performance and engagement metrics.</p>
        </div>
        
        <div class="analytics-summary">
            <div class="metric-box">
                <div class="metric-label">Avg. Open Rate</div>
                <div class="metric-value">42.5%</div>
                <div class="metric-trend trend-up">‚Üë 5% vs last week</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Click Rate</div>
                <div class="metric-value">18.2%</div>
                <div class="metric-trend trend-up">‚Üë 2% vs last week</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Bounce Rate</div>
                <div class="metric-value">0.8%</div>
                <div class="metric-trend trend-down">‚Üì 0.2% vs last week</div>
            </div>
        </div>

        <div class="automation-card">
            <div class="automation-header">
                <h2>Email Performance (Last 7 Days)</h2>
            </div>
            <div class="automation-content">
                <div class="chart-container" id="analyticsChart">
                    </div>
            </div>
        </div>
      </section>
      
      <section id="templatesSection" class="section-content" aria-labelledby="templatesTitle" style="display: none;">
        <div class="welcome-card">
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <div>
                <h1 id="templatesTitle">Templates</h1>
                <p>Manage your saved message layouts and quick responses.</p>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="createNewTemplate()">+ New Template</button>
             </div>
          </div>
        </div>
        
        <div class="templates-grid" id="templatesGrid">
            </div>
      </section>
      
      <section id="settingsSection" class="section-content" aria-labelledby="settingsTitle" style="display: none;">
        <div class="welcome-card">
          <h1 id="settingsTitle">Settings</h1>
          <p>Configure your account preferences and notifications.</p>
        </div>
        
        <div class="settings-container">
            <div class="automation-card">
                <div class="automation-content">
                    <div class="settings-group">
                        <div class="settings-title">Profile Information</div>
                        <form id="profileForm" onsubmit="event.preventDefault(); saveSettings(this);">
                            <div class="message-form">
                                <div class="form-group">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="settingsName" value="Admin User">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="settingsEmail" value="admin@example.com">
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="settings-group">
                        <div class="settings-title">Notifications</div>
                        <div class="toggle-row">
                            <div>
                                <div class="toggle-label">Email Campaign Summary</div>
                                <div class="toggle-desc">Receive a weekly summary of your campaign stats</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <div>
                                <div class="toggle-label">New Customer Alert</div>
                                <div class="toggle-desc">Get notified when a new customer is added</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-title">Security</div>
                        <div class="action-buttons">
                            <button class="btn btn-secondary">Change Password</button>
                            <button class="btn btn-danger-outline" onclick="confirmLogout()">Log Out Everywhere</button>
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                        <button class="btn btn-primary" onclick="saveSettings(this)">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
      </section>
    </div>
  </main>
</div>

<div class="modal" id="addCustomerModal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Add Customer</h3>
    </div>
    <form id="customerForm" onsubmit="event.preventDefault(); saveNewCustomer();">
      <div class="form-group">
        <label class="form-label required" for="newCustomerName">Full Name</label>
        <input type="text" class="form-control" id="newCustomerName" required placeholder="Jane Doe">
      </div>
      <div class="form-group">
        <label class="form-label" for="newCustomerEmail">Email</label>
        <input type="email" class="form-control" id="newCustomerEmail" placeholder="jane@example.com">
      </div>
      <div class="form-group">
        <label class="form-label" for="newCustomerPhone">Phone</label>
        <input type="tel" class="form-control" id="newCustomerPhone" placeholder="+1 (555) 000-0000">
      </div>
      <div class="form-group">
        <label class="form-label" for="newCustomerCompany">Company</label>
        <input type="text" class="form-control" id="newCustomerCompany" placeholder="Acme Inc.">
      </div>
      <div class="form-group">
        <label class="form-label" for="newCustomerStatus">Status</label>
        <select class="form-control" id="newCustomerStatus">
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
          <option value="Pending">Pending</option>
        </select>
      </div>
      <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px;">
        <button type="button" class="btn btn-secondary" onclick="closeModal('addCustomerModal')">Cancel</button>
        <button type="submit" id="btnSaveCustomer" class="btn btn-primary">Save Record</button>
      </div>
    </form>
  </div>
</div>

<div class="modal" id="templateModal" role="dialog" aria-labelledby="templateModalTitle" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="templateModalTitle">Add New Template</h3>
    </div>
    <form id="templateForm" onsubmit="event.preventDefault(); saveTemplate();">
      <input type="hidden" id="templateIndex">
      <div class="form-group">
        <label class="form-label required" for="templateName">Template Name</label>
        <input type="text" class="form-control" id="templateName" required placeholder="e.g. Welcome Series">
      </div>
      <div class="form-group">
        <label class="form-label" for="templateTag">Tag (Category)</label>
        <input type="text" class="form-control" id="templateTag" placeholder="e.g. Sales, Onboarding">
      </div>
      <div class="form-group full-width">
        <label class="form-label required" for="templateSubject">Subject Line</label>
        <input type="text" class="form-control" id="templateSubject" required placeholder="Email Subject">
      </div>
      <div class="form-group full-width">
        <label class="form-label required" for="templateBody">Email Body</label>
        <textarea class="form-control" id="templateBody" required placeholder="Hi {name}..." style="min-height: 200px;"></textarea>
      </div>
      <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px;">
        <button type="button" class="btn btn-secondary" onclick="closeModal('templateModal')">Cancel</button>
        <button type="submit" id="btnSaveTemplate" class="btn btn-primary">Save Template</button>
      </div>
    </form>
  </div>
</div>

<div class="modal" id="previewModal" role="dialog" aria-labelledby="previewTitle" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="previewTitle">Message Preview</h3>
    </div>
    <div style="margin-bottom: 24px; padding: 16px; background: var(--bg-subtle); border-radius: var(--radius-sm);">
      <div style="font-size: 12px; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 4px;">Subject</div>
      <div id="previewSubject" style="font-weight: 600; font-size: 16px;"></div>
    </div>
    <div style="padding: 24px; border: 1px solid var(--border-light); border-radius: var(--radius-sm); font-family: var(--font-sans); min-height: 200px; max-height: 400px; overflow-y: auto; line-height: 1.6; white-space: pre-wrap;" id="previewBody">
    </div>
    <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px;">
      <button type="button" class="btn btn-secondary" onclick="closeModal('previewModal')">Back to Edit</button>
      <button type="button" id="btnConfirmSend" class="btn btn-primary" onclick="sendAutomatedMessages()">Confirm & Send</button>
    </div>
  </div>
</div>

<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/api.js"></script>
<script src="js/ui.js"></script>
<script src="js/app.js"></script>

</body>
</html>